"""Промпты для анализа транскрипций видео для поиска вирусных фрагментов."""


VIRAL_SEGMENTS_PROMPT_TEMPLATE = """Ты - эксперт по созданию вирусного контента для YouTube Shorts и TikTok.

Проанализируй транскрипцию видео и найди фрагменты, которые имеют потенциал стать вирусными шортсами.

ТРАНСКРИПЦИЯ:
{transcript_text}

КРИТЕРИИ ВИРУСНОГО ФРАГМЕНТА:
1. Длительность: 25-60 секунд (оптимально 30-45 сек)
2. Наличие хука - цепляющего начала (первые 3 секунды)
3. Наличие кульминации/панчлайна - яркого момента или вывода
4. Эмоциональная насыщенность (юмор, удивление, инсайт, провокация)
5. Законченность - фрагмент должен быть самодостаточным
6. Динамичность - нет затянутых пауз

ТИПЫ ВИРУСНЫХ ФРАГМЕНТОВ:
- Неожиданный поворот или факт
- Жизненный лайфхак или совет
- Провокационное утверждение
- Эмоциональная история
- Юмор или ирония
- Ценный инсайт или откровение

ЗАДАЧА:
Найди 5-10 фрагментов с score >= 7

Верни JSON в формате:
{{
  "segments": [
    {{
      "start": <начало в секундах>,
      "end": <конец в секундах>,
      "hook": "<первые слова, которые цепляют (до 15 слов)>",
      "punchline": "<кульминация или ключевая мысль (до 20 слов)>",
      "virality_score": <оценка от 1 до 10>,
      "reason": "<почему это вирусный фрагмент (1-2 предложения)>",
      "emotion": "<основная эмоция: humor/surprise/insight/provocation/inspiration>"
    }}
  ]
}}

ВАЖНО:
- Выбирай только лучшие фрагменты с virality_score >= 6
- Фрагменты НЕ должны пересекаться по времени
- Длительность строго 25-60 секунд
- Верни ТОЛЬКО валидный JSON без дополнительного текста"""


def format_transcript_for_analysis(segments: list[dict]) -> str:
    """
    Форматирует сегменты транскрипции для анализа Claude.

    Args:
        segments: Список словарей сегментов с полями start, end, text

    Returns:
        Отформатированный текст транскрипции с временными метками
    """
    formatted_lines = []

    for seg in segments:
        timestamp = f"[{seg['start']:.1f}s - {seg['end']:.1f}s]"
        text = seg['text'].strip()
        formatted_lines.append(f"{timestamp} {text}")

    return "\n".join(formatted_lines)


def create_viral_segments_prompt(transcript_text: str) -> str:
    """
    Создает промпт для поиска вирусных фрагментов в транскрипции.

    Args:
        transcript_text: Отформатированный текст транскрипции

    Returns:
        Промпт для Claude API
    """
    return VIRAL_SEGMENTS_PROMPT_TEMPLATE.format(
        transcript_text=transcript_text
    )
