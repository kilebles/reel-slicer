"""Промпты для анализа транскрипций видео для поиска вирусных фрагментов."""

VIRAL_SEGMENTS_PROMPT_TEMPLATE = """Ты - профессиональный рилсмейкер. Твоя цель: "нарезать" видео на МАКСИМАЛЬНОЕ количество потенциально вирусных фрагментов.

ТРАНСКРИПЦИЯ:
{transcript_text}

КРИТИЧЕСКИ ВАЖНО:
Ты ОБЯЗАН найти МИНИМУМ 5 фрагментов, даже если видео короткое. Это ТРЕБОВАНИЕ, а не рекомендация.

ИНСТРУКЦИЯ ПО ПОИСКУ:
- Ищи ВСЁ интересное: мысли, советы, инсайты, шутки, истории, провокационные заявления, эмоциональные моменты
- Будь ОЧЕНЬ либеральным в оценке - если хоть что-то может зацепить, включай это
- Длительность: от 20 до 60 секунд. Идеал - 30-40 секунд
- Если спикер закончил мысль раньше - отлично, это идеальный фрагмент
- Игнорируй ТОЛЬКО техническую "воду" (затяжные паузы, оговорки, приветствия в начале)

АГРЕССИВНАЯ СТРАТЕГИЯ:
- Если видео 10-15 минут -> ищи минимум 5-8 фрагментов
- Если видео 20-30 минут -> ищи минимум 8-12 фрагментов
- Если видео 40-60 минут -> ищи минимум 12-20 фрагментов
- НЕ БУДЬ ПРИДИРЧИВЫМ. Лучше больше фрагментов для тестирования.

Верни JSON:
{{
  "segments": [
    {{
      "start": <float>,
      "end": <float>,
      "hook": "<первая фраза>",
      "punchline": "<финальный аккорд>",
      "virality_score": <1-10>,
      "reason": "<кратко: почему это зацепит>",
      "emotion": "<humor/surprise/insight/provocation/inspiration>"
    }}
  ]
}}

ВАЖНО:
- Минимальный virality_score: 5 (мы тестируем, нужно количество)
- Фрагменты не должны пересекаться
- ОБЯЗАТЕЛЬНО найди минимум 5 фрагментов, иначе результат неприемлем
- Верни ТОЛЬКО чистый JSON без комментариев"""


def format_transcript_for_analysis(segments: list[dict]) -> str:
    """
    Форматирует сегменты транскрипции для анализа Claude.

    Args:
        segments: Список словарей сегментов с полями start, end, text

    Returns:
        Отформатированный текст транскрипции с временными метками
    """
    formatted_lines = []

    for seg in segments:
        timestamp = f"[{seg['start']:.1f}s - {seg['end']:.1f}s]"
        text = seg["text"].strip()
        formatted_lines.append(f"{timestamp} {text}")

    return "\n".join(formatted_lines)


def create_viral_segments_prompt(transcript_text: str) -> str:
    """
    Создает промпт для поиска вирусных фрагментов в транскрипции.

    Args:
        transcript_text: Отформатированный текст транскрипции

    Returns:
        Промпт для Claude API
    """
    return VIRAL_SEGMENTS_PROMPT_TEMPLATE.format(transcript_text=transcript_text)
